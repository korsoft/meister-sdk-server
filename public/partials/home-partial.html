<div ng-cloak >

<main-menu></main-menu>
<main-toolbar></main-toolbar>

 <md-content ng-init="init()" id="content" >
    <div flex-xs flex-gt-xs="100" layout="column">

    <md-card md-theme-watch>
        <md-card-title style="padding:5px 5px 5px">
          <md-card-title-text>
            <span class="md-headline"  style="font-size: 18px">SAP Gateway {{gatewaySelected.name ? ': ' + gatewaySelected.name : ''}} - {{client.sap_number}}</span>
          </md-card-title-text>
          <md-card-title-media>
            <div class="md-media-xs card-media"></div>
          </md-card-title-media>
           <md-actions>
              <md-button  aria-label="Refresh" 
                      title="{{show_select_gateway === true ? 'Hide' : 'Show'}}" 
                      ng-click="show_select_gateway = !show_select_gateway" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     {{show_select_gateway === true ? 'Hide' : 'Show'}}
                  </md-button>
          </md-actions>
        </md-card-title>
        <md-card-content ng-show="show_select_gateway">
          <div layout="row">
             <md-input-container style="width: 200px">
               <label >Select Gateway:</label>
              <md-select ng-model="gatewaySelectedId" placeholder="Select Gateway"  ng-change="changeGateway(gatewaySelectedId)">
                 <md-option ng-repeat="g in gateways" ng-value="g.id">
                      {{g.name}}
                  </md-option>
            </md-select>
          </md-input-container>
          <md-input-container  style="width: 150px">
                    <label >Select Client:</label>
                    <md-select ng-model="client" placeholder="Select Client" ng-model-options="{trackBy: '$value.id'}">
                       <md-option ng-repeat="c in clients" ng-value="c.client">
                            {{c.client.sap_number}}
                        </md-option>
                  </md-select>
            </md-input-container>
          <md-input-container style="width: 100px">
               <md-button class="md-raised md-primary"  ng-disabled="!gatewaySelected || (clients.length && !client.id)" 
               ng-click="executeGateway()" >
              Connect
            </md-button>
          </md-input-container>
            
        </div>
        
        </md-card-content>
      </md-card>

    </div>

 

 <md-content layout-xs="column" layout="row" ng-if="gatewaySelected!=null">
  <div flex-xs flex-gt-xs="5" layout="column" ng-if="tree_collapsible">
    <md-card >
        <md-card-title style="-webkit-flex:none">
          <md-card-title-text>
            <div layout="row">
                
            </div>
          </md-card-title-text>
        <md-actions>
          <md-button class="md-icon-button" aria-label="Refresh" title="Show Tree"
                      ng-click="show_tree()" style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'navigate_next'"></md-icon>
                  </md-button>
        </md-actions>
        <md-card-content>
        
       </md-card-content>
      </md-card>
  </div>
 <div id="treeCointaner" flex-xs flex-gt-xs="35" layout="column" ng-if="!tree_collapsible">
   
       <md-card >
        <md-card-title style="-webkit-flex:none">
          <md-card-title-text>
            <div layout="row">
                <span class="md-headline">{{gatewaySelected.name}}</span>
            </div>
          </md-card-title-text>
        <md-actions>
                  <md-button hide-xs class="md-icon-button" aria-label="Refresh" title="Hide Tree"
                      ng-click="hide_tree()" style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'navigate_before'"></md-icon>
                  </md-button>
                <!--<md-button class="md-icon-button" aria-label="Refresh" title="Refresh"
                      ng-click="changeGateway(gatewaySelectedId)" style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'cached'"></md-icon>
                  </md-button>
                  <md-button class="md-icon-button" aria-label="Refresh" 
                      title="Add Module" 
                      ng-if="nodeSelected && nodeSelected.source.MODULES"
                      ng-click="addModule($event, nodeSelected)" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'note_add'"></md-icon>
                  </md-button>
                  <md-button class="md-icon-button" aria-label="Refresh" 
                      title="Add Endpoint" 
                      ng-if="nodeSelected && nodeSelected.source.ENDPOINTS"
                      ng-click="addEndpoint($event, nodeSelected)" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'note_add'"></md-icon>
                  </md-button>
                  <md-button class="md-icon-button" aria-label="Refresh" 
                      title="Add Style" 
                      ng-if="nodeSelected && nodeSelected.source.STYLES"
                      ng-click="addStyle($event, nodeSelected)" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'note_add'"></md-icon>
                  </md-button>
                  <md-button class="md-icon-button" aria-label="Refresh" 
                      title="Execute" 
                      ng-if="nodeSelected && nodeSelected.source.STYLES"
                      ng-click="execute($event, nodeSelected)" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'send'"></md-icon>
                  </md-button>
                   <md-button class="md-icon-button" aria-label="Refresh" 
                      title="Execute" 
                      ng-if="nodeSelected && nodeSelected.source && !nodeSelected.source.MODULES && !nodeSelected.source.ENDPOINTS && !nodeSelected.source.STYLES"
                      ng-click="execute_by_style($event, nodeSelected)" 
                      style="padding: 0px; margin: 0px; width: 22px">
                     <md-icon ng-bind="'send'"></md-icon>
                  </md-button>
                -->
        </md-actions>
        </md-card-title>
       <md-card-content style="height: 600px; overflow-y: auto;padding-left: 0px" ng-if="!loading_tree">
        <tree nodes='basicTree' options='treeOptions' ></tree>
       </md-card-content>
      </md-card>
   
   </div>
    
    <div flex-xs flex-gt-xs="{{tree_collapsible ? 95 : 65}}" layout="column" ng-show="nodeSelected">

      <md-card  ng-if="!mode_run">
        <md-card-title style="-webkit-flex:none;padding-bottom: 23px;">
          <md-card-title-text>
            <span class="md-headline">Properties</span>
          </md-card-title-text>
         
        </md-card-title>
        <md-card-content style="height: 600px; overflow-y: auto" >
           <table md-table style="table-layout: fixed">
                    <thead md-head>
                      <tr md-row >
                          <th md-column style="width: 35%">Property</th>
                          <th md-column style="width: 50%">Value</th>
                          <th md-column style="width: 15%"></th>
                      </tr>
                    </thead>
                    <tbody md-body>
                      <tr md-row class="with-hover" ng-repeat="(key, value) in nodeSelected.source" ng-if="key!='PKY' && key!='FKY' && key!='MEISTER_OWN' && key!='LOGICAL_DELETE' && !isArray(value)">
                        <td md-cell style="text-overflow:ellipsis;overflow:hidden;padding:0px"><span title="{{key}}">{{key}}</span></td>
                        <td md-cell style="text-overflow:ellipsis;overflow:hidden;padding:0px">

                          <span ng-if="!nodeSelected.source[key+$index].$edit && key!='JSON'" title="{{isArray(value) ? '(Collection)' : value}}">{{isArray(value) ? '(Collection)' : value}}</span>
                          <div ng-if="!nodeSelected.source[key+$index].$edit && key=='JSON'">
                            <div  ng-if="!nodeSelected.source[key+$index].$edit && key=='JSON'" ui-ace="{ mode: 'json'}" readonly style="width: 100%; height: 215px;"  ng-model="json_to_object(value)|json"></div>
                          </div>
                          <div ng-show="nodeSelected.source[key+$index].$edit && key=='LONG_TEXT'">
                              <md-input-container class="md-block">
                                <input type="text" ng-model="current_long_text">
                              </md-input-container>
                          </div>
                          <md-input-container class="md-block" ng-if="nodeSelected.source[key+$index].$edit && key!='LONG_TEXT'"">
                            <label>{{key}}</label>
                            <input type="text" ng-model="nodeSelected.source[key]" >
                          </md-input-container>

                        </td>
                        <td md-cell style="padding: 0px">
                          <md-button class="md-icon-button" aria-label="Edit" ng-if="!nodeSelected.source[key+$index].$edit && key=='LONG_TEXT'" ng-click="editLongText(nodeSelected,$index)">
                                <md-icon ng-bind="'edit'"></md-icon>
                          </md-button>
                          <div layout="row"  ng-if="nodeSelected.source[key+$index].$edit && key=='LONG_TEXT'">
                            <md-button class="md-icon-button" aria-label="Save"  ng-click="saveLongText(nodeSelected,$index,current_long_text)">
                              <md-icon ng-bind="'save'" ></md-icon>
                            </md-button>
                            <md-button class="md-icon-button" aria-label="Cancel" ng-click="cancelLongText(nodeSelected,$index)">
                              <md-icon ng-bind="'cancel'"></md-icon>  
                            </md-button>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                </table>
        </md-card-content>
      </md-card>

      <md-card ng-if="mode_run">
        <md-card-title style="padding-bottom: 9px;">
          <md-card-title-text>
            <span class="md-headline">Call Syntax</span>
          </md-card-title-text>
          <md-actions  ng-if="!loading_tree">
            <md-button class="md-raised"  ng-if="payload_json.json" ng-disabled="!payload_json.json_test" ng-click="execute_details($event)" >
              Execute Json
            </md-button>
            <!--<md-button class="md-raised">
              Call Details
            </md-button> -->
          </md-actions>
        </md-card-title>
        <md-card-content style="height: 600px;  overflow-y: auto"  ng-if="!loading_tree">
          <md-select ng-model="json_logs_executes_title" placeholder="Select the JSON execute" 
            style="width:80%" ng-change="changeJsonLogExecute(json_logs_executes_title)">
             <md-option ng-repeat="g in json_logs_executes" ng-value="g.title">
                  {{g.title}}
              </md-option>
          </md-select>
          <md-input-container class="md-block" ng-if="payload_json.json && url_details!=''">
            <label >Url Details</label>
            <input ng-model="url_details" type="text" readonly="true">
          </md-input-container>
          <md-content layout="column"  style="background-color: transparent;">
            <div layout-gt-sm="row">
              
                <md-input-container flex ng-if="payload_json.json && styles && styles.length>0" style="margin-bottom: 0px">
                    <label >Select the Style </label>
                    <md-select ng-model="styleSelected"  style="width: 50%" placeholder="Select the Style"  ng-change="changeStyle(styleSelected)" >
                       <md-option ng-repeat="style in styles" ng-value="style" ng-selected="styleSelected.name == style.name">
                            {{style.name}}
                        </md-option>
                  </md-select>
                </md-input-container>
               
              
                <md-input-container flex ng-if="payload_json.json" style="margin-bottom: 0px">
                  <label>JSON</label>
                  <textarea readonly="true" ng-value="json_to_string(payload_json.json)" rows="4" style="font-size: 10px;color: gray;line-height:18px" md-no-autogrow>
                  </textarea>
                </md-input-container>
            </div>
            <md-input-container style="margin-top: 0px">
                <label>Compression</label>
                <md-select  ng-model="wrap.compression" >
                  <md-option value="N" >None</md-option>
                  <md-option value="O" >Outbound</md-option>
                  <md-option value="I" >Inbound</md-option>
                  <md-option value="B" >Both</md-option>
                </md-select>
            </md-input-container>
          </md-content>
          <md-tabs md-dynamic-height md-border-bottom md-selected="opt.selectedIndex" ng-show="opt.show">
            <md-tab label="REQUEST" md-on-select="setRequest()">
            </md-tab>
            <md-tab label="RESPONSE" md-on-select="setResponse()">
            </md-tab>
          </md-tabs>
          <div id="sourceURLField" ng-if="payload_json.json" ui-ace="{ onLoad : editorLoaded,mode: 'json'}" style="width: 100%; height: 215px;"  ng-model="payload_json.json_string"></div>
        </md-card-content>
      </md-card>

   </div>
 </md-content>

 <md-content ng-if="mode_run && json_logs.length>0">
   <md-card >
        <md-card-title>
          <md-card-title-text>
            <span class="md-subheadline">RESULT</span>
          </md-card-title-text>
           <md-actions >
            <md-button class="md-raised"  ng-click="clear_log_json_result()" >
              Clear log
            </md-button>
          </md-actions>
        </md-card-title>
        <md-card-content  >
          <md-select ng-model="json_logs_title" placeholder="Select the JSON Result" 
            style="width:80%" ng-change="changeJsonLog(json_logs_title)">
             <md-option ng-repeat="g in json_logs" ng-value="g.title">
                  {{g.title}}
              </md-option>
        </md-select>
          <md-tabs md-dynamic-height md-border-bottom>
            <md-tab label="Plain Format">
              <br/><span class="title-log-result">{{json_logs_title}}: Result</span><br/>
              <md-content class="md-padding">
                <span class="content-log-result"> <code><pre>{{json_logs_content}}</pre></code></span>
              </md-content>
            </md-tab>
            <md-tab label="Tree format">
              <br/><span class="title-log-result">{{json_logs_title}}: Result</span><br/>
                <div ng-jsoneditor="onLoadJson" ng-model="json_logs_content_obj" options="payload_json.options" style="width: 100%; height: 300px;"></div>
            </md-tab>
          </md-tabs>
        </md-card-content>
      </md-card>
</md-content>
</md-content>
</div>
