var meister=angular.module("meister",["ngMaterial","ngAnimate","ngSanitize","ngMessages","ngAria","ui.router","ngCookies","md.data.table","chart.js","TreeWidget","angular-oauth2"]);meister.constant("SERVER_BASE_URL","http://localhost:8000"),meister.constant("CLIENT_SECRET_KEY","GzkU62Ruwo29riFgJHVDPw377k8hYu5dXXYxgYSR"),meister.constant("SYSTEM_ADMIN",99),meister.constant("CLIENT_ADMIN",49),meister.constant("CLIENT_USER",29),meister.constant("COOKIE_LAST_REQUEST","meister-sdk-last-request"),meister.constant("COOKIE_MAX_TIMEOUT_REQUEST",1),function(e){e.config(["$stateProvider","$urlRouterProvider","OAuthProvider","OAuthTokenProvider","SERVER_BASE_URL","CLIENT_SECRET_KEY",function(e,t,o,n,r,i){n.configure({name:"meister-sdk-token",options:{secure:!1}}),o.configure({baseUrl:r,clientId:"2",clientSecret:i,grantPath:"/api/login",revokePath:"/api/logout"}),t.otherwise("/home"),e.state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"LoginController"}).state("home",{url:"/home",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("clients",{url:"/clients",templateUrl:"partials/clients-partial.html",controller:"ClientController"}).state("users",{url:"/users",templateUrl:"partials/users-partial.html",controller:"UserController"}).state("edit-profile",{url:"/edit-profile",templateUrl:"partials/edit-profile-partial.html",controller:"EditProfileController"}).state("gateways",{url:"/gateways",templateUrl:"partials/client-gateways-partial.html",controller:"ClientGatewayController"})}]).run(["$rootScope","$location","$mdToast","OAuth",function(e,t,o,n){e.OAuth=n,e.$on("$locationChangeStart",function(e,o,r){console.log("locationChangeStart---\x3e"),"/login"===t.path()||n.isAuthenticated()||t.path("/login")}),e.$on("oauth:error",function(e,r){if(console.log("oauth:error---\x3e"),"invalid_grant"!==r.data.error)return"invalid_token"===r.data.error?n.getRefreshToken():(o.show(o.simple().textContent(r.data.error).position("top").highlightClass("md-warn").hideDelay(3e3)),t.path("/login"))})}]),e.factory("httpResponseInterceptor",["$q","$timeout","$rootScope","$location","$cookies","COOKIE_LAST_REQUEST","COOKIE_MAX_TIMEOUT_REQUEST",function(e,t,o,n,r,i,a){return{request:function(t){var n=r.get(i);if(n){var l=Date.now(),s=l-n,c=Math.round(s/6e4);console.log("resultInMinutes",c),c>a&&(console.log("Revoke token authentication..."),o.logout())}r.put(i,Date.now());var u=e.defer();return u.resolve(t),u.promise},responseError:function(t){return 401===t.status&&(console.log("401 ERROR"),r.remove("meister-sdk-token"),n.path("/login")),e.reject(t)}}}]),e.config(function(e){e.interceptors.push("httpResponseInterceptor")})}(meister),function(e){e.factory("AuthenticationService",["OAuth",function(e){var t={};return t.Login=function(t,o){return e.getAccessToken({username:t,password:o,email:t})},t.Logout=function(){return e.revokeToken()},t}])}(meister),function(e){e.factory("apiUtils",["$http","SERVER_BASE_URL",function(e,t){var o=t+"/api",n=function(e,t,n,r){var i={};return i.method=e,i.url=o+t,i.params=n||{},r&&(i.data=r),i},r={};return r.get=function(t,o,r){var i=n("GET",t,o,null);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.post=function(t,o,r){var i=n("POST",t,null,o);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.put=function(t,o,r){var i=n("PUT",t,null,o);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r.del=function(t,o,r){var i=n("DELETE",t,o,r);e(i).then(function(e){r(null,e.data)},function(e){r(e,null)})},r}])}(meister),function(e){e.factory("ClientService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.index=function(){return e.get(t+"/api/clients")},o.store=function(o){return e.post(t+"/api/clients",o)},o.show=function(o){return e.get(t+"/api/clients/"+o)},o.update=function(o,n){return e.put(t+"/api/clients/"+o,n)},o.destroy=function(o){return e.delete(t+"/api/clients/"+o)},o}])}(meister),function(e){e.factory("GatewayService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.index=function(){return e.get(t+"/api/clientgateways")},o.store=function(o){return e.post(t+"/api/clientgateways",o)},o.show=function(o){return e.get(t+"/api/clientgateways/"+o)},o.update=function(o,n){return e.put(t+"/api/clientgateways/"+o,n)},o.destroy=function(o){return e.delete(t+"/api/clientgateways/"+o)},o.test_connection=function(o){return e.get(t+"/api/clientgateways/"+o+"/test_connection")},o.execute=function(o){return e.get(t+"/api/clientgateways/"+o+"/execute")},o}])}(meister),function(e){e.factory("MessageUtil",["$mdToast",function(e){var t={};return t.showError=function(t){e.show(e.simple().textContent(t).position("top right").theme("error-toast").hideDelay(3e3))},t.showInfo=function(t){e.show(e.simple().textContent(t).position("top right").hideDelay(3e3))},t}])}(meister),function(e){e.factory("UserService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.index=function(){return e.get(t+"/api/users")},o.store=function(o){return e.post(t+"/api/users",o)},o.show=function(o){return e.get(t+"/api/users/"+o)},o.update=function(o,n){return e.put(t+"/api/users/"+o,n)},o.destroy=function(o){return e.delete(t+"/api/users/"+o)},o.types=function(){return e.get(t+"/api/types")},o.update_my_user=function(o,n){return e.put(t+"/api/users/"+o+"/update_my_user",n)},o}])}(meister),function(e){e.controller("ClientController",["$scope","$location","$mdToast","$mdDialog","ClientService","MessageUtil",function(e,t,o,n,r,i){e.clients=[],e.promise=null,e.filter={show:!1},e.query={order:"name",limit:5,page:1,filter:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filter=""},e.init=function(){console.log("ClientController init..."),e.promise=r.index(),e.promise.then(function(t){console.log("result",t),e.clients=t.data},function(e){console.log("failure login",e),i.showError(e.data.message)})},e.add=function(t,o){n.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:null}}).then(function(t){i.showInfo("Client was created"),e.init()},function(){})},e.edit=function(t,o){n.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:o}}).then(function(t){i.showInfo("Client was updated"),e.init()},function(){})},e.delete=function(t,o){var a=n.confirm().title("You are about to delete the following").htmlContent("Client "+o.name).targetEvent(t).ok("Yes").cancel("No");n.show(a).then(function(){e.promise=r.destroy(o.id),e.promise.then(function(t){i.showInfo("Client was deleted"),e.init()},function(e){i.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("ClientDialogController",["$scope","$mdDialog","client","ClientService","MessageUtil",function(e,t,o,n,r){e.client={},e.promise=null,e.cancel=function(){t.cancel()},o?e.client=angular.copy(o):e.client.name="",console.log("Client",o),e.save=function(){e.client.id?e.promise=n.update(e.client.id,e.client):e.promise=n.store(e.client),e.promise.then(function(e){console.log("result",e),t.hide(e)},function(e){console.log("error",e),r.showError(e.data.message)})}}])}(meister),function(e){e.controller("ClientGatewayController",["$scope","$location","$mdToast","$mdDialog","MessageUtil","GatewayService",function(e,t,o,n,r,i){e.gateways=[],e.promise=null,e.filter={show:!1},e.query={order:"name",limit:5,page:1,filterByName:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filterByName=""},e.init=function(){console.log("ClientGatewayController init..."),e.promise=i.index(),e.promise.then(function(t){console.log("result",t),e.gateways=t.data},function(e){console.log("failure",e),r.showError(e.data.message)})},e.add=function(t,o){n.show({controller:"ClientGatewayDialogController",templateUrl:"templates/client-gateway-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{gateway:null}}).then(function(t){r.showInfo("Gateway was created"),e.init()},function(){})},e.type=function(e){return 0==e?"BASIC":1==e?"FORM":2==e?"DIGEST":3==e?"OAUTH":4==e?"OAUTH2":""},e.edit=function(t,o){n.show({controller:"ClientGatewayDialogController",templateUrl:"templates/client-gateway-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{gateway:o}}).then(function(t){r.showInfo("Gateway was updated"),e.init()},function(){})},e.delete=function(t,o){var a=n.confirm().title("You are about to delete the following").htmlContent("Gateway "+o.name).targetEvent(t).ok("Yes").cancel("No");n.show(a).then(function(){e.promise=i.destroy(o.id),e.promise.then(function(t){r.showInfo("Gateway was deleted"),e.init()},function(e){r.showError(e.data.message)})},function(){})},e.test_connection=function(t,o){e.promise=i.test_connection(o.id),e.promise.then(function(e){r.showInfo("Connection successful")},function(e){r.showError(e.data.message)})}}])}(meister),function(e){e.controller("ClientGatewayDialogController",["$scope","$rootScope","$mdDialog","gateway","GatewayService","ClientService","MessageUtil",function(e,t,o,n,r,i,a){e.gateway={},e.clients=[],e.types=[{id:0,name:"BASIC"},{id:1,name:"FORM"},{id:2,name:"DIGEST"},{id:3,name:"OAUTH"},{id:4,name:"OAUTH2"}],e.promise=null,e.cancel=function(){o.cancel()},n?e.gateway=angular.copy(n):(e.gateway.name="",e.gateway.url="",e.gateway.username="",e.gateway.password="",e.gateway.auth_type=0,e.gateway.digest="",e.gateway.consumer_key="",e.gateway.consumer_secret="",e.gateway.token="",e.gateway.token_secret="",e.gateway.client_id_for_oauth2="",e.gateway.client_secret_for_oauth2="",e.gateway.auth_url_for_oauth2=""),console.log("gateway",n),t.user_type()==t.SYSTEM_ADMIN&&(e.promise=i.index(),e.promise.then(function(t){console.log("result",t),e.clients=t.data},function(e){console.log("error",e),a.showError(e.data.message)})),e.changeAuthType=function(t){e.gateway.auth_type=t,2!=t&&(e.gateway.digest=""),3!=t&&(e.gateway.consumer_key="",e.gateway.consumer_secret="",e.gateway.token="",e.gateway.token_secret="",e.gateway.username="",e.gateway.password=""),4!=t&&(e.gateway.client_id_for_oauth2="",e.gateway.client_secret_for_oauth2="",e.gateway.auth_url_for_oauth2="")},e.save=function(){e.gateway.id?e.promise=r.update(e.gateway.id,e.gateway):e.promise=r.store(e.gateway),e.promise.then(function(e){console.log("result",e),o.hide(e)},function(e){console.log("error",e),a.showError(e.data.message)})}}])}(meister),function(e){e.controller("EditProfileController",["$scope","$rootScope","$mdToast","UserService","MessageUtil",function(e,t,o,n,r){e.user={},e.repassword="",e.promise=null,e.init=function(){console.log("EditProfileController init..."),e.promise=n.show(t.user_id()),e.promise.then(function(t){console.log("result",t),e.user=t.data,e.user.password=""},function(e){console.log("failure login",e),r.showError(e.data.message)})},e.update=function(){e.promise=n.update_my_user(t.user_id(),e.user),e.promise.then(function(t){r.showInfo("User was updated"),e.user.password="",e.repassword=""},function(e){console.log("failure login",e),r.showError(e.data.message)})}}])}(meister),function(e){e.controller("HomeController",["$scope","$mdToast","$mdDialog","MessageUtil","GatewayService",function(e,t,o,n,r){e.promise=null,e.gateways=[],e.gatewaySelectedId=null,e.gatewaySelected=null,e.treeOptions={showIcon:!1,expandOnClick:!0},e.nodeSelected=null,e.nodeExpanded=null;var i=null;e.init=function(){console.log("home controller init..."),e.promise=r.index(),e.promise.then(function(t){console.log("result",t),e.gateways=t.data},function(e){console.log("failure",e),n.showError(e.data.message)})},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};var a=function(){e.basicTree=[];var t={name:e.gatewaySelected.name,children:[]};if(e.basicTree.push(t),console.log("Building tree",i),i&&i.d&&i.d.results&&i.d.results.length>0){var o=angular.fromJson(i.d.results[0].Json);console.log("Json",o),_.forEach(o,function(e){var o={name:e.PROJECT,source:e,children:[]};t.children.push(o),_.forEach(e.MODULES,function(e){var t={name:e.NAME,source:e,children:[]};o.children.push(t),_.forEach(e.ENDPOINTS,function(e){var o={name:e.NAMESPACE,source:e,expanded:!1,children:[]};t.children.push(o),_.forEach(e.STYLES,function(e){var t={name:e.NAME,source:e,expanded:!1,children:[]};o.children.push(t)})})})})}};e.changeGateway=function(t){e.gatewaySelectedId=t,e.nodeSelected=null,e.nodeExpanded=null,console.log("Gateway selected",e.gatewaySelectedId),e.gatewaySelected=_.find(e.gateways,function(e){return t==e.id}),e.promise=r.execute(t),e.promise.then(function(e){console.log("result",e),i=e.data,n.showInfo("Gateway data loaded"),a()},function(e){console.log("failure",e),n.showError(e.data.message)})},e.$on("selection-changed",function(t,o){console.log("Node selected",o),e.nodeSelected=o}),e.$on("expanded-state-changed",function(t,o){console.log("Expanded node",o),e.nodeExpanded=o})}])}(meister),function(e){e.controller("LoginController",["$scope","$rootScope","$location","$mdToast","$cookies","AuthenticationService","MessageUtil","COOKIE_LAST_REQUEST",function(e,t,o,n,r,i,a,l){r.remove("meister-sdk-token"),r.remove(l),e.login=function(){e.promise=i.Login(e.username,e.password),e.promise.then(function(e){console.log("Login",e),e.data&&e.data.access_token?o.path("/home"):(r.remove("meister-sdk-token"),a.showError("The user credentials were incorrect"))},function(e){console.log("failure login",e),a.showError("The user credentials were incorrect")})}}])}(meister),function(e){e.controller("MainController",["$scope","$rootScope","$cookies","$location","$timeout","$mdSidenav","$mdMenu","$state","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER","AuthenticationService",function(e,t,o,n,r,i,a,l,s,c,u,d){function f(e){return function(){i(e).toggle()}}console.log("MainController init"),t.toggleLeft=f("left"),t.toggleRight=f("right"),t.SYSTEM_ADMIN=s,t.CLIENT_ADMIN=c,t.CLIENT_USER=u,t.openMenu=function(e,t){e(t)},t.logout=function(){d.Logout().then(function(e){console.log("Logout successful",e),n.path("/login")},function(e){console.log(e)})},t.user_type=function(){var e=o.get("meister-sdk-token");return e?(e=angular.fromJson(e),e.user_type):-1},t.user_id=function(){var e=o.get("meister-sdk-token");return e?(e=angular.fromJson(e),e.user_id):0},t.transition="fade-in"}])}(meister),function(e){e.controller("UserController",["$scope","$location","$mdToast","$mdDialog","UserService","MessageUtil","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER",function(e,t,o,n,r,i,a,l,s){e.users=[],e.promise=null,e.filter={show:!1},e.query={order:"email",limit:5,page:1,filterByEmail:"",filterByFirstName:"",filterByLastName:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filterByEmail="",e.query.filterByFirstName="",e.query.filterByLastName=""},e.init=function(){console.log("UserController init..."),e.promise=r.index(),e.promise.then(function(t){console.log("result",t),e.users=t.data},function(e){console.log("failure login",e),i.showError(e.data.message)})},e.add=function(t,o){n.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:null}}).then(function(t){i.showInfo("User was created"),e.init()},function(){})},e.edit=function(t,o){n.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:o}}).then(function(t){i.showInfo("User was updated"),e.init()},function(){})},e.type=function(e){return e==a?"SYSTEM_ADMIN":e==l?"CLIENT_ADMIN":e==s?"CLIENT_USER":void 0},e.delete=function(t,o){var a=n.confirm().title("You are about to delete the following").htmlContent("User "+o.name).targetEvent(t).ok("Yes").cancel("No");n.show(a).then(function(){e.promise=r.destroy(o.id),e.promise.then(function(t){i.showInfo("User was deleted"),e.init()},function(e){i.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("UserDialogController",["$scope","$rootScope","$mdDialog","user","ClientService","UserService","MessageUtil",function(e,t,o,n,r,i,a){e.user={},e.types=[],e.clients=[],e.promise=null,e.cancel=function(){o.cancel()},n?e.user=angular.copy(n):(e.user.email="",e.user.first_name="",e.user.last_name="",e.user.type=t.CLIENT_USER,e.user.client_id=null),console.log("User",n),t.user_type()==t.SYSTEM_ADMIN?r.index().then(function(t){e.clients=t.data,e.user.id||(e.user.client_id=t.data[0].id)},function(e){console.log("error",e),a.showError(e.data.message)}):(e.clients=[],e.client_id=null),i.types().then(function(t){e.types=t.data},function(e){console.log("error",e),a.showError(e.data.message)}),e.save=function(){e.user.id?e.promise=i.update(e.user.id,e.user):e.promise=i.store(e.user),e.promise.then(function(e){console.log("result",e),o.hide(e)},function(e){console.log("error",e),a.showError(e.data.message)})}}])}(meister),function(e){e.directive("mainMenu",function(){return{restrict:"E",templateUrl:"templates/main-menu.html"}})}(meister),function(e){e.directive("mainToolbar",function(){return{restrict:"E",templateUrl:"templates/main-toolbar.html"}})}(meister);