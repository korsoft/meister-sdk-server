var meister=angular.module("meister",["ngMaterial","ngAnimate","ngSanitize","ngMessages","ngAria","ui.router","ngCookies","md.data.table","chart.js","TreeWidget","angular-oauth2","ng.jsoneditor","angular-loading-bar"]);meister.constant("SERVER_BASE_URL","http://localhost:8000"),meister.constant("CLIENT_SECRET_KEY","GzkU62Ruwo29riFgJHVDPw377k8hYu5dXXYxgYSR"),meister.constant("SYSTEM_ADMIN",99),meister.constant("CLIENT_ADMIN",49),meister.constant("CLIENT_USER",29),meister.constant("COOKIE_LAST_REQUEST","meister-sdk-last-request"),meister.constant("COOKIE_MAX_TIMEOUT_REQUEST",30),function(e){e.config(["$stateProvider","$compileProvider","$mdDateLocaleProvider","$urlRouterProvider","OAuthProvider","OAuthTokenProvider","SERVER_BASE_URL","CLIENT_SECRET_KEY","cfpLoadingBarProvider",function(e,n,o,t,l,i,r,a,s){o.formatDate=function(e){return moment(e).format("YYYY-MM-DD")},s.includeSpinner=!1,n.preAssignBindingsEnabled(!0),i.configure({name:"meister-sdk-token",options:{secure:!1}}),l.configure({baseUrl:r,clientId:"2",clientSecret:a,grantPath:"/api/login",revokePath:"/api/logout"}),t.otherwise("/home"),e.state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"LoginController"}).state("home",{url:"/home",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("clients",{url:"/clients",templateUrl:"partials/clients-partial.html",controller:"ClientController"}).state("users",{url:"/users",templateUrl:"partials/users-partial.html",controller:"UserController"}).state("edit-profile",{url:"/edit-profile",templateUrl:"partials/edit-profile-partial.html",controller:"EditProfileController"}).state("gateways",{url:"/gateways",templateUrl:"partials/client-gateways-partial.html",controller:"ClientGatewayController"}).state("endpointManagementTool",{url:"/endpoint-management-tool",templateUrl:"partials/endpoint-management-tool-partial.html",controller:"EndpointManagementToolController"})}]).run(["$rootScope","$location","$mdToast","OAuth",function(e,n,o,t){e.OAuth=t,e.$on("$locationChangeStart",function(e,o,l){console.log("locationChangeStart---\x3e"),"/login"===n.path()||t.isAuthenticated()||n.path("/login")}),e.$on("oauth:error",function(e,l){if(console.log("oauth:error---\x3e"),"invalid_grant"!==l.data.error)return"invalid_token"===l.data.error?t.getRefreshToken():(o.show(o.simple().textContent(l.data.error).position("top").highlightClass("md-warn").hideDelay(3e3)),n.path("/login"))})}]),e.factory("httpResponseInterceptor",["$q","$timeout","$rootScope","$location","$cookies","COOKIE_LAST_REQUEST","COOKIE_MAX_TIMEOUT_REQUEST",function(e,n,o,t,l,i,r){return{request:function(n){var t=l.get(i);if(t){var a=Date.now(),s=a-t,c=Math.round(s/6e4);console.log("resultInMinutes",c),c>r&&(console.log("Revoke token authentication..."),o.logout())}l.put(i,Date.now());var d=e.defer();return d.resolve(n),d.promise},responseError:function(n){return 401===n.status&&(console.log("401 ERROR"),l.remove("meister-sdk-token"),t.path("/login")),e.reject(n)}}}]),e.config(function(e){e.interceptors.push("httpResponseInterceptor")})}(meister),function(e){e.factory("AuthenticationService",["OAuth",function(e){var n={};return n.Login=function(n,o){return e.getAccessToken({username:n,password:o,email:n})},n.Logout=function(){return e.revokeToken()},n}])}(meister),function(e){e.factory("apiUtils",["$http","SERVER_BASE_URL",function(e,n){var o=n+"/api",t=function(e,n,t,l){var i={};return i.method=e,i.url=o+n,i.params=t||{},l&&(i.data=l),i},l={};return l.get=function(n,o,l){var i=t("GET",n,o,null);e(i).then(function(e){l(null,e.data)},function(e){l(e,null)})},l.post=function(n,o,l){var i=t("POST",n,null,o);e(i).then(function(e){l(null,e.data)},function(e){l(e,null)})},l.put=function(n,o,l){var i=t("PUT",n,null,o);e(i).then(function(e){l(null,e.data)},function(e){l(e,null)})},l.del=function(n,o,l){var i=t("DELETE",n,o,l);e(i).then(function(e){l(null,e.data)},function(e){l(e,null)})},l}])}(meister),function(e){e.factory("ClientService",["$http","SERVER_BASE_URL",function(e,n){var o={};return o.index=function(){return e.get(n+"/api/clients")},o.store=function(o){return e.post(n+"/api/clients",o)},o.show=function(o){return e.get(n+"/api/clients/"+o)},o.update=function(o,t){return e.put(n+"/api/clients/"+o,t)},o.destroy=function(o){return e.delete(n+"/api/clients/"+o)},o}])}(meister),function(e){e.factory("GatewayService",["$http","SERVER_BASE_URL",function(e,n){var o={};return o.index=function(){return e.get(n+"/api/clientgateways")},o.store=function(o){return e.post(n+"/api/clientgateways",o)},o.show=function(o){return e.get(n+"/api/clientgateways/"+o)},o.update=function(o,t){return e.put(n+"/api/clientgateways/"+o,t)},o.destroy=function(o){return e.delete(n+"/api/clientgateways/"+o)},o.test_connection=function(o){return e.get(n+"/api/clientgateways/"+o+"/test_connection")},o.execute=function(o){return e.get(n+"/api/clientgateways/"+o+"/execute")},o.execute_changes=function(o,t){return e.post(n+"/api/clientgateways/"+o+"/execute",t)},o.execute_endpoint=function(o,t){return e.post(n+"/api/clientgateways/"+o+"/execute_endpoint",t)},o.buildJsonByNewModule=function(e,n,o){console.log("buildJsonByNewEndpoint..."),console.log("json",e),console.log("parentNode",n),console.log("module",o);var t={},l=_.find(e,function(e){return e.PKY==n.PKY});if(l){console.log("project",l),t.PKY=l.PKY,t.PROJECT=l.PROJECT,t.MODULES=[];var i={PKY:o.PKY,NAME:o.NAME,DATE:moment(o.DATE).format("YYYYMMDD"),ENDPOINTS:o.ENDPOINTS};t.MODULES.push(i)}return t},o.buildJsonByNewEndpoint=function(e,n,o){console.log("buildJsonByNewEndpoint..."),console.log("json",e),console.log("parentNode",n),console.log("endpoint",o);var t={};return _.forEach(e,function(e){console.log("project",e),t.PKY=e.PKY,t.PROJECT=e.PROJECT,t.MODULES=[];var l=_.find(e.MODULES,function(e){return e.PKY==n.PKY});if(console.log("module",l),l){var i={PKY:l.PKY,NAME:l.NAME,DATE:l.DATE.split("-").join(""),ENDPOINTS:[]};return i.ENDPOINTS.push(o),t.MODULES.push(i),!1}}),t},o.buildJsonByNewStyle=function(e,n,o){console.log("buildJsonByNewEndpoint..."),console.log("json",e),console.log("parentNode",n),console.log("style",o);var t={};return _.forEach(e,function(e){console.log("project",e),t.PKY=e.PKY,t.PROJECT=e.PROJECT,t.MODULES=[];var l=_.find(e.MODULES,function(e){if(_.find(e.ENDPOINTS,function(e){return e.PKY==n.PKY}))return e});if(console.log("module",l),l){var i={PKY:l.PKY,NAME:l.NAME,DATE:l.DATE.split("-").join(""),ENDPOINTS:[]},r=_.find(l.ENDPOINTS,function(e){return e.PKY==n.PKY});return r.STYLES=[],r.STYLES.push(o),i.ENDPOINTS.push(r),t.MODULES.push(i),!1}}),t},o}])}(meister),function(e){e.factory("MessageUtil",["$mdToast",function(e){var n={};return n.showError=function(n){e.show(e.simple().textContent(n).position("top right").theme("error-toast").hideDelay(3e3))},n.showInfo=function(n){e.show(e.simple().textContent(n).position("top right").hideDelay(3e3))},n}])}(meister),function(e){e.factory("UserService",["$http","SERVER_BASE_URL",function(e,n){var o={};return o.index=function(){return e.get(n+"/api/users")},o.store=function(o){return e.post(n+"/api/users",o)},o.show=function(o){return e.get(n+"/api/users/"+o)},o.update=function(o,t){return e.put(n+"/api/users/"+o,t)},o.destroy=function(o){return e.delete(n+"/api/users/"+o)},o.types=function(){return e.get(n+"/api/types")},o.update_my_user=function(o,t){return e.put(n+"/api/users/"+o+"/update_my_user",t)},o}])}(meister),function(e){e.controller("ClientController",["$scope","$location","$mdToast","$mdDialog","ClientService","MessageUtil",function(e,n,o,t,l,i){e.clients=[],e.promise=null,e.filter={show:!1},e.query={order:"name",limit:5,page:1,filter:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filter=""},e.init=function(){console.log("ClientController init..."),e.promise=l.index(),e.promise.then(function(n){console.log("result",n),e.clients=n.data},function(e){console.log("failure login",e),i.showError(e.data.message)})},e.add=function(n,o){t.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:null}}).then(function(n){i.showInfo("Client was created"),e.init()},function(){})},e.edit=function(n,o){t.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:o}}).then(function(n){i.showInfo("Client was updated"),e.init()},function(){})},e.delete=function(n,o){var r=t.confirm().title("You are about to delete the following").htmlContent("Client "+o.name).targetEvent(n).ok("Yes").cancel("No");t.show(r).then(function(){e.promise=l.destroy(o.id),e.promise.then(function(n){i.showInfo("Client was deleted"),e.init()},function(e){i.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("ClientDialogController",["$scope","$mdDialog","client","ClientService","MessageUtil",function(e,n,o,t,l){e.client={},e.promise=null,e.cancel=function(){n.cancel()},o?e.client=angular.copy(o):e.client.name="",console.log("Client",o),e.save=function(){e.client.id?e.promise=t.update(e.client.id,e.client):e.promise=t.store(e.client),e.promise.then(function(e){console.log("result",e),n.hide(e)},function(e){console.log("error",e),l.showError(e.data.message)})}}])}(meister),function(e){e.controller("ClientGatewayController",["$scope","$location","$mdToast","$mdDialog","MessageUtil","GatewayService",function(e,n,o,t,l,i){e.gateways=[],e.promise=null,e.filter={show:!1},e.query={order:"name",limit:5,page:1,filterByName:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filterByName=""},e.init=function(){console.log("ClientGatewayController init..."),e.promise=i.index(),e.promise.then(function(n){console.log("result",n),e.gateways=n.data},function(e){console.log("failure",e),l.showError(e.data.message)})},e.add=function(n,o){t.show({controller:"ClientGatewayDialogController",templateUrl:"templates/client-gateway-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{gateway:null}}).then(function(n){l.showInfo("Gateway was created"),e.init()},function(){})},e.type=function(e){return 0==e?"BASIC":1==e?"FORM":2==e?"DIGEST":3==e?"OAUTH":4==e?"OAUTH2":""},e.edit=function(n,o){t.show({controller:"ClientGatewayDialogController",templateUrl:"templates/client-gateway-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{gateway:o}}).then(function(n){l.showInfo("Gateway was updated"),e.init()},function(){})},e.delete=function(n,o){var r=t.confirm().title("You are about to delete the following").htmlContent("Gateway "+o.name).targetEvent(n).ok("Yes").cancel("No");t.show(r).then(function(){e.promise=i.destroy(o.id),e.promise.then(function(n){l.showInfo("Gateway was deleted"),e.init()},function(e){l.showError(e.data.message)})},function(){})},e.test_connection=function(n,o){e.promise=i.test_connection(o.id),e.promise.then(function(e){l.showInfo("Connection successful")},function(e){l.showError(e.data.message)})}}])}(meister),function(e){e.controller("ClientGatewayDialogController",["$scope","$rootScope","$mdDialog","gateway","GatewayService","ClientService","MessageUtil",function(e,n,o,t,l,i,r){e.gateway={},e.clients=[],e.types=[{id:0,name:"BASIC"},{id:1,name:"FORM"},{id:2,name:"DIGEST"},{id:3,name:"OAUTH"},{id:4,name:"OAUTH2"}],e.promise=null,e.cancel=function(){o.cancel()},t?e.gateway=angular.copy(t):(e.gateway.name="",e.gateway.url="",e.gateway.username="",e.gateway.password="",e.gateway.auth_type=0,e.gateway.digest="",e.gateway.consumer_key="",e.gateway.consumer_secret="",e.gateway.token="",e.gateway.token_secret="",e.gateway.client_id_for_oauth2="",e.gateway.client_secret_for_oauth2="",e.gateway.auth_url_for_oauth2="",e.gateway.endpoint_lookup="",e.gateway.endpoint_master=""),console.log("gateway",t),n.user_type()==n.SYSTEM_ADMIN&&(e.promise=i.index(),e.promise.then(function(n){console.log("result",n),e.clients=n.data},function(e){console.log("error",e),r.showError(e.data.message)})),e.changeAuthType=function(n){e.gateway.auth_type=n,2!=n&&(e.gateway.digest=""),3!=n&&(e.gateway.consumer_key="",e.gateway.consumer_secret="",e.gateway.token="",e.gateway.token_secret="",e.gateway.username="",e.gateway.password=""),4!=n&&(e.gateway.client_id_for_oauth2="",e.gateway.client_secret_for_oauth2="",e.gateway.auth_url_for_oauth2="")},e.save=function(){e.gateway.id?e.promise=l.update(e.gateway.id,e.gateway):e.promise=l.store(e.gateway),e.promise.then(function(e){console.log("result",e),o.hide(e)},function(e){console.log("error",e),r.showError(e.data.message)})}}])}(meister),function(e){e.controller("EditProfileController",["$scope","$rootScope","$mdToast","UserService","MessageUtil",function(e,n,o,t,l){e.user={},e.repassword="",e.promise=null,e.init=function(){console.log("EditProfileController init..."),e.promise=t.show(n.user_id()),e.promise.then(function(n){console.log("result",n),e.user=n.data,e.user.password=""},function(e){console.log("failure login",e),l.showError(e.data.message)})},e.update=function(){e.promise=t.update_my_user(n.user_id(),e.user),e.promise.then(function(n){l.showInfo("User was updated"),e.user.password="",e.repassword=""},function(e){console.log("failure login",e),l.showError(e.data.message)})}}])}(meister),function(e){e.controller("EndpointDialogController",["$scope","$mdDialog","endpoint","parentNode","gateway","json","GatewayService","MessageUtil",function(e,n,o,t,l,i,r,a){e.endpoint={},e.parentNode={},e.page=1,e.promise=null,e.cancel=function(){n.cancel()},o?e.endpoint=angular.copy(o):(e.endpoint.PKY="",e.endpoint.NAMESPACE="",e.endpoint.LONG_TEXT="",e.endpoint.ENDPOINT_MAIN="",e.endpoint.HANDLER="",e.endpoint.BUS_NAME="",e.endpoint.TYPE="",e.endpoint.VERSION="",e.endpoint.LOCKED="",e.endpoint.PACKAGE="",e.endpoint.TRANSPORT="",e.endpoint.STYLES=[{PKY:"",DIRECTION:"I",NAME:"Default",JSON:"",CLASS_NAME:""}]),e.parentNode=t,console.log("Endpoint",o),console.log("ParenNode",t),e.save=function(){var o=r.buildJsonByNewEndpoint(i,t.source,e.endpoint),s={json:angular.toJson(o)};e.promise=r.execute_changes(l.id,s),e.promise.then(function(e){console.log("result",e),n.hide(e)},function(e){console.log("error",e),a.showError(e.data.message)})},e.changePage=function(n){e.page=n},e.addStyle=function(){e.endpoint.STYLES.push({PKY:"",DIRECTION:"",NAME:"",JSON:"",CLASS_NAME:""})},e.deleteStyle=function(n){e.endpoint.STYLES.splice(n,1)},e.checkUniqueName=function(){for(var n=[],o=0;o<e.endpoint.STYLES.length;o++){if(void 0!==n[e.endpoint.STYLES[o].NAME+e.endpoint.STYLES[o].DIRECTION])return!0;n[e.endpoint.STYLES[o].NAME+e.endpoint.STYLES[o].DIRECTION]=1}return!1}}])}(meister),function(e){e.controller("EndpointManagementToolController",["$scope","$mdToast","$mdDialog","MessageUtil","GatewayService",function(e,n,o,t,l){e.promise=null,e.gateways=[],e.gatewaySelectedId=null,e.gatewaySelected=null,e.treeOptions={showIcon:!1,expandOnClick:!1},e.nodeSelected=null,e.nodeExpanded=null;var i=null;e.json=null,e.payload_json={json:null,options:{mode:"tree"}},e.endpointsTree=[],e.payloadsTree=[],e.styleSelected=null,e.styles=[],e.show_select_gateway=!0,e.json_details="",e.url_details="",e.loading_tree=!1,e.init=function(){console.log("home controller init..."),e.promise=l.index(),e.promise.then(function(n){console.log("result",n),e.gateways=n.data},function(e){console.log("failure",e),t.showError(e.data.message)})},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.build_tree=function(){console.log("build_tree..."),e.endpointsTree=[],e.payloadsTree=[],e.payload_json={json:null,options:{mode:"tree"}},e.json_details="",e.url_details="",e.styleSelected=null;var n={name:e.gatewaySelected.name,children:[]};e.endpointsTree.push(n),console.log("Building tree",i),i&&i.d&&i.d.results&&i.d.results.length>0&&(e.json=angular.fromJson(i.d.results[0].Json),console.log("Json",e.json),_.forEach(e.json,function(e){var o={name:e.PROJECT,source:e,children:[]};n.children.push(o),_.forEach(e.MODULES,function(e){var n={name:e.NAME,source:e,children:[]};o.children.push(n),_.forEach(e.ENDPOINTS,function(e){var o={name:e.NAMESPACE,source:e,expanded:!1,children:[]};n.children.push(o),_.forEach(e.STYLES,function(e){var n={name:e.NAME,source:e,expanded:!1,parent:o,children:[]};o.children.push(n)})})})}))},e.changeGateway=function(n){console.log("changeGateway",n),e.loading_tree=!0,e.url_details="",e.gatewaySelectedId=n,e.nodeSelected=null,e.nodeExpanded=null,e.styleSelected=null,console.log("Gateway selected",e.gatewaySelectedId),e.show_select_gateway=!1,e.gatewaySelected=_.find(e.gateways,function(e){return n==e.id}),e.promise=l.execute(n),e.promise.then(function(n){e.loading_tree=!1,console.log("result",n),i=n.data,t.showInfo("Gateway data loaded"),e.build_tree()},function(n){e.loading_tree=!1,console.log("failure",n),t.showError(n.data.message)})},e.execute=function(n,o){console.log("Execute event for endpoint",o);var i={endpoint:o.name};e.json_details="",e.promise=l.execute_endpoint(e.gatewaySelected.id,i),e.promise.then(function(n){console.log("result",n),e.payload_json.json=angular.fromJson(n.data.data.d.results[0].Json)},function(e){console.log("failure",e),t.showError(e.data.message)})},e.execute_by_style=function(n,o){console.log("execute_by_style",e.endpointsTree),e.styleSelected=o,e.execute(n,o.parent)},e.execute_details=function(n){var o=null;o=e.styleSelected?e.styleSelected.parent:e.nodeSelected,console.log("Execute details event",o);var i={endpoint:o.name,json:JSON.stringify(e.payload_json.json,null,"    "),style:e.styleSelected?e.styleSelected.name:"DEFAULT"};e.promise=l.execute_endpoint(e.gatewaySelected.id,i),e.promise.then(function(n){console.log("result",n),e.url_details=n.data.url,e.json_details=angular.fromJson(n.data.data.d.results[0].Json)},function(e){console.log("failure",e),t.showError(e.data.message)})},e.pretty_payload_json=function(e){return angular.toJson(e,!0)},e.json_to_string=function(e){return JSON.stringify(e)},e.onLoadJson=function(e){e.expandAll()},e.changeStyle=function(n){e.styleSelected=n,e.styleSelected.parent=e.nodeSelected,console.log("changeStyle",n)},e.$on("selection-changed",function(n,o){console.log("Node selected",o),e.payload_json={json:null,options:{mode:"tree"}},e.url_details="",e.nodeSelected=o,e.styles=[],e.styleSelected=null,e.json_details="",o.source.STYLES&&o.source.STYLES.length>0&&(console.log("Styles",o.source.STYLES),e.styles=o.children,e.styleSelected=o.children[0],e.styleSelected.parent=o)}),e.$on("expanded-state-changed",function(n,o){console.log("Expanded node",o),e.nodeExpanded=o})}])}(meister),function(e){e.controller("HomeController",["$scope","$rootScope","$mdMenu","$mdToast","$mdDialog","MessageUtil","GatewayService",function(e,n,o,t,l,i,r){e.promise=null,e.gateways=[],e.gatewaySelectedId=null,e.gatewaySelected=null,e.treeOptions={showIcon:!1,expandOnClick:!1},e.nodeSelected=null,e.nodeExpanded=null;var a=null;e.json=null,e.show_select_gateway=!0,e.loading_tree=!1,e.payload_json={json:null,options:{mode:"tree"}},e.payloadsTree=[],e.basicTree=[],e.styleSelected=null,e.styles=[],e.show_select_gateway=!0,e.json_details="",e.url_details="",e.mode_run=!1,e.init=function(){console.log("home controller init..."),e.promise=r.index(),e.promise.then(function(n){console.log("result",n),e.gateways=n.data},function(e){console.log("failure",e),i.showError(e.data.message)})},e.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},e.build_tree=function(){e.basicTree=[];var n={name:e.gatewaySelected.name,children:[]};e.mode_run=!1,e.payloadsTree=[],e.payload_json={json:null,options:{mode:"tree"}},e.url_details="",e.styleSelected=null,e.basicTree.push(n),console.log("Building tree",a),a&&a.d&&a.d.results&&a.d.results.length>0&&(e.json=angular.fromJson(a.d.results[0].Json),console.log("Json",e.json),_.forEach(e.json,function(e){var o={name:e.PROJECT,source:e,children:[]};n.children.push(o),_.forEach(e.MODULES,function(e){var n={name:e.NAME,source:e,children:[]};o.children.push(n),_.forEach(e.ENDPOINTS,function(e){var o={name:e.NAMESPACE,source:e,expanded:!1,children:[]};n.children.push(o),_.forEach(e.STYLES,function(e){var n={name:e.NAME,source:e,expanded:!1,children:[]};o.children.push(n)})})})}))},e.changeGateway=function(n){e.loading_tree=!0,e.gatewaySelectedId=n,e.nodeSelected=null,e.nodeExpanded=null,e.show_select_gateway=!1,e.mode_run=!1,e.url_details="",e.styleSelected=null,console.log("Gateway selected",e.gatewaySelectedId),e.gatewaySelected=_.find(e.gateways,function(e){return n==e.id}),e.promise=r.execute(n),e.promise.then(function(n){e.loading_tree=!1,console.log("result",n),a=n.data,i.showInfo("Gateway data loaded"),e.build_tree()},function(n){e.loading_tree=!1,console.log("failure",n),i.showError(n.data.message)})},n.openActionsInNode=function(e,n){console.log("openActionsInNode",n),console.log("mdOpenMenu",e)},e.openActionsInNodeTemp=function(e,n){console.log("openActionsInNodeTemp",n)},e.clear_log_json_result=function(){e.json_details=""},e.$on("selection-changed",function(n,o){if(console.log("Node selected",o),e.payload_json={json:null,options:{mode:"tree"}},e.url_details="",e.nodeSelected=o,e.mode_run=!1,e.styles=[],e.styleSelected=null,!o.source)return void(e.nodeSelected=null);e.nodeSelected=o,o.source.STYLES&&o.source.STYLES.length>0&&(console.log("Styles",o.source.STYLES),e.styles=o.children,e.styleSelected=o.children[0],e.styleSelected.parent=o)}),e.$on("action-node-selected",function(n,o){console.log("action-node-selected",o),"addModule"===o.actionName?e.addModule(o.sourceEvent,o.node):"addEndpoint"==o.actionName?e.addEndpoint(o.sourceEvent,o.node):"addStyle"==o.actionName?e.addStyle(o.sourceEvent,o.node):"execute"==o.actionName?e.execute(o.sourceEvent,o.node):"execute_by_style"==o.actionName&&e.execute_by_style(o.sourceEvent,o.node)}),e.$on("selection-changed",function(n,o){if(console.log("Node selected",o),e.payload_json={json:null,options:{mode:"tree"}},e.url_details="",e.nodeSelected=o,e.styles=[],e.mode_run=!1,e.styleSelected=null,!o.source)return void(e.nodeSelected=null);e.nodeSelected=o,o.source.STYLES&&o.source.STYLES.length>0&&(console.log("Styles",o.source.STYLES),e.styles=o.children,e.styleSelected=o.children[0],e.styleSelected.parent=o)}),e.addModule=function(n,o){e.mode_run=!1,l.show({controller:"ModuleDialogController",templateUrl:"templates/module-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{module:null,parentNode:o,gateway:e.gatewaySelected,json:e.json}}).then(function(n){i.showInfo("Module was created"),e.changeGateway(e.gatewaySelectedId)},function(){})},e.addEndpoint=function(n,o){e.mode_run=!1,l.show({controller:"EndpointDialogController",templateUrl:"templates/endpoint-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{endpoint:null,parentNode:o,gateway:e.gatewaySelected,json:e.json}}).then(function(n){i.showInfo("Endpoint was created"),e.changeGateway(e.gatewaySelectedId)},function(){})},e.addStyle=function(n,o){e.mode_run=!1,l.show({controller:"StyleDialogController",templateUrl:"templates/style-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{style:null,parentNode:o,gateway:e.gatewaySelected,json:e.json}}).then(function(n){i.showInfo("Style was created"),e.changeGateway(e.gatewaySelectedId)},function(){})},e.execute=function(n,o){console.log("Execute event for endpoint",o);var t={endpoint:o.name};e.mode_run=!0,e.promise=r.execute_endpoint(e.gatewaySelected.id,t),e.promise.then(function(n){console.log("result",n),e.payload_json.json=angular.fromJson(n.data.data.d.results[0].Json)},function(e){console.log("failure",e),i.showError(e.data.message)})},e.execute_by_style=function(n,o){console.log("execute_by_style",e.basicTree),e.styleSelected=o,e.execute(n,o.parent)},e.execute_details=function(n){var o=null;o=e.styleSelected?e.styleSelected.parent:e.nodeSelected,console.log("Execute details event",o);var t={endpoint:o.name,json:JSON.stringify(e.payload_json.json,null,""),style:e.styleSelected?e.styleSelected.name:"DEFAULT"};e.promise=r.execute_endpoint(e.gatewaySelected.id,t),e.promise.then(function(n){console.log("result",n),e.url_details=n.data.url,e.json_details+='<span class="title-log-result">RUNTIME: '+moment().format("MMMM DD YYYY, h:mm:ss a")+": Result</span><br/>",e.json_details+='<span class="content-log-result">'+n.data.data.d.results[0].Json+"</span><br/><br/>"},function(e){console.log("failure",e),i.showError(e.data.message)})},e.json_to_string=function(e){return JSON.stringify(e)},e.onLoadJson=function(e){e.expandAll()},e.changeStyle=function(n){e.styleSelected=n,e.styleSelected.parent=e.nodeSelected,console.log("changeStyle",n)}}])}(meister),function(e){e.controller("LoginController",["$scope","$rootScope","$location","$mdToast","$cookies","AuthenticationService","MessageUtil","COOKIE_LAST_REQUEST",function(e,n,o,t,l,i,r,a){l.remove("meister-sdk-token"),l.remove(a),e.login=function(){e.promise=i.Login(e.username,e.password),e.promise.then(function(e){console.log("Login",e),e.data&&e.data.access_token?o.path("/home"):(l.remove("meister-sdk-token"),r.showError("The user credentials were incorrect"))},function(e){console.log("failure login",e),r.showError("The user credentials were incorrect")})}}])}(meister),function(e){e.controller("MainController",["$scope","$rootScope","$cookies","$location","$timeout","$mdSidenav","$mdMenu","$state","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER","AuthenticationService",function(e,n,o,t,l,i,r,a,s,c,d,u){function p(e){return function(){i(e).toggle()}}console.log("MainController init"),n.toggleLeft=p("left"),n.toggleRight=p("right"),n.SYSTEM_ADMIN=s,n.CLIENT_ADMIN=c,n.CLIENT_USER=d,n.openMenu=function(e,n){e(n)},n.logout=function(){u.Logout().then(function(e){console.log("Logout successful",e),t.path("/login")},function(e){console.log(e)})},n.user_type=function(){var e=o.get("meister-sdk-token");return e?(e=angular.fromJson(e),e.user_type):-1},n.user_id=function(){var e=o.get("meister-sdk-token");return e?(e=angular.fromJson(e),e.user_id):0},n.transition="fade-in"}])}(meister),function(e){e.controller("ModuleDialogController",["$scope","$mdDialog","module","parentNode","gateway","json","GatewayService","MessageUtil",function(e,n,o,t,l,i,r,a){e.module={},e.promise=null,e.cancel=function(){n.cancel()},o?e.module=angular.copy(o):(e.module.PKY="",e.module.NAME="",e.module.DATE=new Date,e.module.ENDPOINTS=[]),console.log("Module",o),console.log("ParenNode",t),e.save=function(){var o=r.buildJsonByNewModule(i,t.source,e.module),s={json:JSON.stringify(o)};e.promise=r.execute_changes(l.id,s),e.promise.then(function(e){console.log("result",e),n.hide(e)},function(e){console.log("error",e),a.showError(e.data.message)})}}])}(meister),function(e){e.controller("ResponseEndpointExecutionDialogController",["$scope","$mdDialog","json",function(e,n,o){e.json=o,e.cancel=function(){n.cancel()},e.pretty_payload_json=function(e){return angular.toJson(e,!0)}}])}(meister),function(e){e.controller("StyleDialogController",["$scope","$mdDialog","style","parentNode","gateway","json","GatewayService","MessageUtil",function(e,n,o,t,l,i,r,a){e.style={},e.promise=null,e.cancel=function(){n.cancel()},o?e.style=angular.copy(o):(e.style.PKY="",e.style.DIRECTION="",e.style.NAME="",e.style.JSON=""),console.log("Style",o),console.log("ParenNode",t),e.save=function(){var o=r.buildJsonByNewStyle(i,t.source,e.style),s={json:JSON.stringify(o)};e.promise=r.execute_changes(l.id,s),e.promise.then(function(e){console.log("result",e),n.hide(e)},function(e){console.log("error",e),a.showError(e.data.message)})}}])}(meister),function(e){e.controller("UserController",["$scope","$location","$mdToast","$mdDialog","UserService","MessageUtil","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER",function(e,n,o,t,l,i,r,a,s){e.users=[],e.promise=null,e.filter={show:!1},e.query={order:"email",limit:5,page:1,filterByEmail:"",filterByFirstName:"",filterByLastName:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filterByEmail="",e.query.filterByFirstName="",e.query.filterByLastName=""},e.init=function(){console.log("UserController init..."),e.promise=l.index(),e.promise.then(function(n){console.log("result",n),e.users=n.data},function(e){console.log("failure login",e),i.showError(e.data.message)})},e.add=function(n,o){t.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:null}}).then(function(n){i.showInfo("User was created"),e.init()},function(){})},e.edit=function(n,o){t.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:n,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:o}}).then(function(n){i.showInfo("User was updated"),e.init()},function(){})},e.type=function(e){return e==r?"SYSTEM_ADMIN":e==a?"CLIENT_ADMIN":e==s?"CLIENT_USER":void 0},e.delete=function(n,o){var r=t.confirm().title("You are about to delete the following").htmlContent("User "+o.name).targetEvent(n).ok("Yes").cancel("No");t.show(r).then(function(){e.promise=l.destroy(o.id),e.promise.then(function(n){i.showInfo("User was deleted"),e.init()},function(e){i.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("UserDialogController",["$scope","$rootScope","$mdDialog","user","ClientService","UserService","MessageUtil",function(e,n,o,t,l,i,r){e.user={},e.types=[],e.clients=[],e.promise=null,e.cancel=function(){o.cancel()},t?e.user=angular.copy(t):(e.user.email="",e.user.first_name="",e.user.last_name="",e.user.type=n.CLIENT_USER,e.user.client_id=null),console.log("User",t),n.user_type()==n.SYSTEM_ADMIN?l.index().then(function(n){e.clients=n.data,e.user.id||(e.user.client_id=n.data[0].id)},function(e){console.log("error",e),r.showError(e.data.message)}):(e.clients=[],e.client_id=null),i.types().then(function(n){e.types=n.data},function(e){console.log("error",e),r.showError(e.data.message)}),e.save=function(){e.user.id?e.promise=i.update(e.user.id,e.user):e.promise=i.store(e.user),e.promise.then(function(e){console.log("result",e),o.hide(e)},function(e){console.log("error",e),r.showError(e.data.message)})}}])}(meister),function(e){"use strict";e.module("TreeWidget",["ngAnimate","RecursionHelper"]).directive("tree",[function(){return{restrict:"E",scope:{nodes:"=",options:"=?"},template:"<treenode nodes='nodes' oncontextmenu='return false' tree='nodelist' options='options'></treenode>",compile:function(e,n,o){return{pre:function(e){function n(o,t){if(void 0!=o&&o.length>0)for(var l=0;l<o.length;l++){var i=o[l];void 0===i.nodeId&&(i.nodeId=10*Math.random()+1,e.count++),void 0===i.expanded&&void 0!=i.children&&(i.expanded=!0),void 0!=t&&(i.parentId=t.nodeId),-1==e.nodelist.indexOf(i)&&e.nodelist.push(i),n(i.children,i)}}e.nodelist=[],e.options=e.options||(e.options={showIcon:!0,expandOnClick:!1,multipleSelect:!1}),e.count=0,e.$watch(function(){n(e.nodes)})}}}}}]).filter("nodeFilter",["$filter",function(n){return function(o,t){var l=function(o,t){var i=[];return e.forEach(o,function(o){if(n("filter")([o],t).length>0)i.push(o);else if(e.isArray(o.children)&&o.children.length>0){var r=l(o.children,t);r.length>0&&i.push(o)}}),i};return l(o,t)}}]).directive("treenode",["RecursionHelper","$timeout",function(n,o){return{restrict:"E",scope:{nodes:"=",tree:"=",options:"=?"},
template:'<ul oncontextmenu="return false" ><li ng-repeat="node in nodes | nodeFilter:options.filter track by node.nodeId" class="node" id="{{::node.nodeId}}"><i class="tree-node-ico pointer" ng-class="{\'tree-node-expanded\': node.expanded && (node.children | nodeFilter:options.filter).length > 0,\'tree-node-collapsed\':!node.expanded && (node.children | nodeFilter:options.filter).length > 0}" ng-click="toggleNode(node)"></i><span class="node-title pointer" ng-click="selectNode(node, $event)" ng-class="{\'disabled\':node.disabled}"><span><i class="tree-node-ico" ng-if="options.showIcon" ng-class="{\'tree-node-image\':node.children, \'tree-node-leaf\':!node.children}" ng-style="node.image && {\'background-image\':\'url(\'+node.image+\')\'}"></i>     <span class="node-name" tabindex="{{::(node.focusable ? 0 : -1)}}" ng-class="{selected: node.selected&& !node.disabled}"> <span ng-if="!node.source">{{node.name}}</span> <md-menu ng-if="node.source">     <span ng-click="$mdMenu.open()"  ng-mouseup="openMenu($mdOpenMenu,$event,node)">       {{node.name}}     </span>     <md-menu-content  oncontextmenu="return false" >         <md-menu-item ng-if="node  && node.source.MODULES"> <md-button        ng-click="emitActionNodeSelected(\'addModule\',node,$event)"  >     <md-icon ng-bind="\'note_add\'"></md-icon> Add module  </md-button>         </md-menu-item>         <md-menu-item ng-if="node  && node.source.ENDPOINTS"> <md-button        ng-click="emitActionNodeSelected(\'addEndpoint\',node,$event)"  >     <md-icon ng-bind="\'note_add\'"></md-icon> Add endpoint  </md-button>         </md-menu-item>         <md-menu-item ng-if="node  && node.source.STYLES"> <md-button        ng-click="emitActionNodeSelected(\'addStyle\',node,$event)"  >     <md-icon ng-bind="\'note_add\'"></md-icon> Add style  </md-button>         </md-menu-item>         <md-menu-item ng-if="node  && node.source.STYLES"> <md-button        ng-click="emitActionNodeSelected(\'execute\',node,$event)"  >     <md-icon ng-bind="\'send\'"></md-icon> Execute  </md-button>         </md-menu-item>         <md-menu-item ng-if="!node.source.MODULES && !node.source.ENDPOINTS && !node.source.STYLES"> <md-button        ng-click="emitActionNodeSelected(\'execute_by_style\',node,$event)"  >     <md-icon ng-bind="\'send\'"></md-icon> Execute  </md-button>         </md-menu-item>    </md-menu-content> </md-menu>         <span ng-if="node.badge != null" class="label" ng-class="node.badge.type">{{node.badge.title}}</span>     </span></span></span><treenode ng-if="node.children && node.expanded" nodes=\'node.children\' tree="tree" options="options"></treenode></li></ul>',compile:function(t){return n.compile(t,function(n,t,l,i,r){function a(o){e.forEach(n.tree,function(e){o!=e&&(e.selected=!1)})}function s(){return n.tree.filter(function(e){return e.selected})}n.emitActionNodeSelected=function(e,o,t){n.$emit("action-node-selected",{actionName:e,node:o,sourceEvent:t})},n.selectNode=function(e,o){if(!e.disabled){var t;!0===n.options.multipleSelect?(e.selected=!e.selected,t=s()):"ctrlKey"===n.options.multipleSelect||"altKey"===n.options.multipleSelect?(o[n.options.multipleSelect]?e.selected=!e.selected:(e.selected=!0,a(e)),t=s()):(e.selected=!0,a(e),t=e),n.$emit("selection-changed",t),n.options.onSelectNode&&n.options.onSelectNode(t),n.options.expandOnClick&&void 0!=e.children&&(e.expanded=!e.expanded,n.$emit("expanded-state-changed",e),n.options.onExpandNode&&n.options.onExpandNode(e))}},n.toggleNode=function(e){void 0!=e.children&&(e.expanded=!e.expanded,n.$emit("expanded-state-changed",e),n.options.onExpandNode&&n.options.onExpandNode(e))},n.openMenu=function(e,n,t){if(3==n.which){var l=s();n.preventDefault(),n.stopPropagation(),1==l.length&&l[0].nodeId==t.nodeId&&(e(n),o(function(){document.getElementsByClassName("md-menu-backdrop")[0].oncontextmenu=function(){return!1}}))}}})}}}])}(angular),function(e){e.directive("mainMenu",function(){return{restrict:"E",templateUrl:"templates/main-menu.html"}})}(meister),function(e){e.directive("mainToolbar",function(){return{restrict:"E",templateUrl:"templates/main-toolbar.html"}})}(meister);