var meister=angular.module("meister",["ngMaterial","ngAnimate","ngSanitize","ngMessages","ngAria","ui.router","ngCookies","md.data.table","chart.js","TreeWidget","angular-oauth2"]);meister.constant("SERVER_BASE_URL","http://localhost:8000"),meister.constant("CLIENT_SECRET_KEY","dFmSH4dR84Pvf7PJHeR76LTzWSIdGpV9Sq3voHLE"),meister.constant("SYSTEM_ADMIN",99),meister.constant("CLIENT_ADMIN",49),meister.constant("CLIENT_USER",29),function(e){e.config(["$stateProvider","$urlRouterProvider","OAuthProvider","OAuthTokenProvider","SERVER_BASE_URL","CLIENT_SECRET_KEY",function(e,t,o,n,i,r){n.configure({name:"meister-sdk-token",options:{secure:!1}}),o.configure({baseUrl:i,clientId:"2",clientSecret:r,grantPath:"/api/login",revokePath:"/api/logout"}),t.otherwise("/"),e.state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"LoginController"}).state("home",{url:"/",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("clients",{url:"/clients",templateUrl:"partials/clients-partial.html",controller:"ClientController"}).state("users",{url:"/users",templateUrl:"partials/users-partial.html",controller:"UserController"}).state("about",{url:"/about",templateUrl:"partials/about-partial.html",controller:"AboutController"}).state("claims",{url:"/claims",templateUrl:"partials/claims-partial.html",controller:"ClaimsController",params:{filters:[]}}).state("reports",{url:"/reports",templateUrl:"partials/reports-partial.html",controller:"ReportsController",params:{filters:[]}}).state("claim-details",{url:"/claims-details",templateUrl:"partials/claim-details-partial.html",controller:"ClaimDetailsController",params:{claimno:""}}).state("reports-summary",{url:"/reports-summary",templateUrl:"partials/reports-summary-partial.html",controller:"ReportSummaryController",params:{PKY:"",reportName:""}})}]).run(["$rootScope","$location","$mdToast","OAuth",function(e,t,o,n){e.$on("$locationChangeStart",function(e,o,i){"/login"===t.path()||n.isAuthenticated()||t.path("/login")}),e.$on("oauth:error",function(e,i){if("invalid_grant"!==i.data.error)return"invalid_token"===i.data.error?n.getRefreshToken():(console.log("oauth:error",i.data.error),o.show(o.simple().textContent(i.data.error).position("top").highlightClass("md-warn").hideDelay(3e3)),t.path("/login"))})}])}(meister),function(e){e.factory("AuthenticationService",["OAuth",function(e){var t={};return t.Login=function(t,o){return e.getAccessToken({username:t,password:o,email:t})},t.Logout=function(){return e.revokeToken()},t}])}(meister),function(e){e.factory("apiUtils",["$http","SERVER_BASE_URL",function(e,t){var o=t+"/api",n=function(e,t,n,i){var r={};return r.method=e,r.url=o+t,r.params=n||{},i&&(r.data=i),r},i={};return i.get=function(t,o,i){var r=n("GET",t,o,null);e(r).then(function(e){i(null,e.data)},function(e){i(e,null)})},i.post=function(t,o,i){var r=n("POST",t,null,o);e(r).then(function(e){i(null,e.data)},function(e){i(e,null)})},i.put=function(t,o,i){var r=n("PUT",t,null,o);e(r).then(function(e){i(null,e.data)},function(e){i(e,null)})},i.del=function(t,o,i){var r=n("DELETE",t,o,i);e(r).then(function(e){i(null,e.data)},function(e){i(e,null)})},i}])}(meister),function(e){e.factory("ClaimsService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.getList=function(){return e.get(t+"/claims")},o.getListDetails=function(){return e.get(t+"/claims/details")},o.getDetails=function(o){return e.get(t+"/claims/detail/"+o)},o.simulate=function(o){return e.get(t+'/claims/simulate?Json={"CLAIMNO":"'+o+'"}')},o.approve=function(o){var n="";return _.forEach(o,function(e){n+='{"CLAIMNO":"'+e+'"},'}),n=n.substring(0,n.length-1),e.get(t+"/claims/approve?Json=["+n+"]")},o}])}(meister),function(e){e.factory("ClientService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.index=function(){return e.get(t+"/api/clients")},o.store=function(o){return e.post(t+"/api/clients",o)},o.show=function(o){return e.get(t+"/api/clients/"+o)},o.update=function(o,n){return e.put(t+"/api/clients/"+o,n)},o.destroy=function(o){return e.delete(t+"/api/clients/"+o)},o}])}(meister),function(e){e.factory("MessageUtil",["$mdToast",function(e){var t={};return t.showError=function(t){e.show(e.simple().textContent(t).position("top right").theme("error-toast").hideDelay(3e3))},t.showInfo=function(t){e.show(e.simple().textContent(t).position("top right").hideDelay(3e3))},t}])}(meister),function(e){e.factory("ReportService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.getReports=function(){return e.get(t+"/reports")},o.getListReports=function(){return e.get(t+"/list_reports")},o.getDetails=function(o){return e.get(t+"/reports/detail/"+o)},o.schedule=function(o){return e.get(t+"/reports/schedule/"+o)},o.buildDataForGraphicReports=function(e){var t=_.groupBy(e,function(e){return e.PstngDate}),o={labels:[],data:[]};return _.each(t,function(e,t){o.labels.push(t);var n=0;_.each(e,function(e){n+=Number(e.Quantity.replace("-",""))}),o.data.push(n)}),o},o}])}(meister),function(e){e.factory("UserService",["$http","SERVER_BASE_URL",function(e,t){var o={};return o.index=function(){return e.get(t+"/api/users")},o.store=function(o){return e.post(t+"/api/users",o)},o.show=function(o){return e.get(t+"/api/users/"+o)},o.update=function(o,n){return e.put(t+"/api/users/"+o,n)},o.destroy=function(o){return e.delete(t+"/api/users/"+o)},o.types=function(){return e.get(t+"/api/types")},o}])}(meister),function(e){e.controller("AboutController",["$scope",function(e){}])}(meister),function(e){e.controller("ClaimDetailsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","ClaimsService",function(e,t,o,n,i,r,l,a,s){e.claim={},e.tabSelected=1,e.is_simulated=!1,e.simulations=[],e.isMobileDevice=i("xs"),e.init=function(){console.log(a),e.promise=s.getDetails(a.claimno),e.promise.then(function(t){if(console.log("ClaimsService.getDetails",t),e.claim=t.data,e.isMobileDevice){var o=[];_.forEach(e.claim.BUDGETS,function(t){t.WBS_ELEMENT==e.claim.APPRAISAL.WBS&&o.push(t)}),e.claim.BUDGETS=o}},function(e){console.log("failure loading claim details",e)})},_.forEach(e.budgets,function(e){e.$show=!1}),e.simulate=function(){e.promise2=s.simulate(a.claimno),e.promise2.then(function(t){if(e.is_simulated=!0,console.log("ClaimsService.simulate",t),t.data&&t.data.length>0&&(e.simulations=t.data[0],e.isMobileDevice)){var o=[];_.forEach(e.simulations,function(t){t.WBS_ELEMENT==e.claim.APPRAISAL.WBS&&o.push(t)}),e.simulations=o}},function(e){console.log("failure loading claim simulate",e)})},e.aproveConfirm=function(t){var o=l.confirm().title("You are about to Approve the following").textContent("You are about to Approve Claim No "+a.claimno).targetEvent(t).ok("Aprove").cancel("cancel");l.show(o).then(function(){e.aprove(t)},function(){e.status="You decided to keep your debt."})},e.aprove=function(t){var o=[];o.push(a.claimno),e.promise3=s.approve(o),e.promise3.then(function(o){console.log("ClaimsService.approve",o),l.show(l.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Claim "+a.claimno+" is Approved").ok("Ok").targetEvent(t)).then(function(){n.go("claims",{filters:[e.claim]})})},function(e){console.log("failure loading claim simulate",e)})}}])}(meister),function(e){e.controller("ClaimsController",["$scope","$timeout","$mdSidenav","$mdMedia","$mdMenu","$state","$stateParams","$mdDialog","ClaimsService",function(e,t,o,n,i,r,l,a,s){function c(e){return function(){o(e).toggle()}}e.toggleLeft=c("left"),e.toggleRight=c("right"),e.claims=[],e.claims_details=[],e.total=null,e.selected=[],e.isMobileDevice=n("xs"),e.gotoClaimDetails=function(e){0!=e.ACCEPTED&&r.go("claim-details",{claimno:e.CLAIM})},e.init=function(t){console.log("init",t),console.log("params",l),e.total=null,e.claims=[],e.claims_details=[],e.promise1=s.getList(),e.promise2=s.getListDetails();var o=[];t&&e.selected.length>0&&(o=angular.copy(e.selected),e.selected=[]),e.promise1.then(function(t){console.log("ClaimsService.getList",t),_.forEach(t.data.data,function(n){if(o.length>0){var i=_.find(o,function(e){return e.WBS==n.WBS});i?t.data.total-=n.total:e.claims.push(n)}else if(l.filters.length>0){var i=_.find(l.filters,function(e){return e.APPRAISAL.WBS==n.WBS});i?t.data.total-=n.total:e.claims.push(n)}else e.claims.push(n)}),e.total=t.data.total},function(e){console.log("failure loading claims",e)}),e.promise2.then(function(t){console.log("ClaimsService.getListDetails",t),_.forEach(t.data.data,function(t){if(o.length>0){var n=_.find(o,function(e){return e.WBS==t.WBS});n||e.claims_details.push(t)}else if(l.filters.length>0){var n=_.find(l.filters,function(e){return e.APPRAISAL.WBS==t.WBS});n||e.claims_details.push(t)}else e.claims_details.push(t)})},function(e){console.log("failure loading claims details",e)})},e.showDetails=function(e){console.log("showDetails",e),e.$showTooltip=!0},e.hideDetails=function(e){console.log("hideDetails",e),e.$showTooltip=!1},e.showDetails2=function(e){console.log("showDetails",e),e.$showTooltip2=!0},e.hideDetails2=function(e){console.log("hideDetails",e),e.$showTooltip2=!1},e.aproveConfirm=function(t){console.log("Approve items selected",e.selected);var o="",n=[];_.forEach(e.selected,function(e){n.push(e.CLAIM),o+="Claim "+e.CLAIM+" on WBS "+e.WBS+" for amount $"+e.ACCEPTED.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g,"$1,")+"<br/>"});var i=a.confirm().title("You are about to Approve the following").htmlContent(o).targetEvent(t).ok("Aprove").cancel("cancel");a.show(i).then(function(){e.aprove(t,n)},function(){e.status="You decided to keep your debt."})},e.aprove=function(t,o){e.promise3=s.approve(o),e.promise3.then(function(o){console.log("ClaimsService.approve",o),a.show(a.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Successful").textContent("Selected Claims are Approved").ok("Ok").targetEvent(t)).then(function(){e.init(!0)})},function(e){console.log("failure loading claim simulate",e)})}}])}(meister),function(e){e.controller("ClientController",["$scope","$location","$mdToast","$mdDialog","ClientService","MessageUtil",function(e,t,o,n,i,r){e.clients=[],e.promise=null,e.filter={show:!1},e.query={order:"name",limit:5,page:1,filter:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filter=""},e.init=function(){console.log("ClientController init..."),e.promise=i.index(),e.promise.then(function(t){console.log("result",t),e.clients=t.data},function(e){console.log("failure login",e),r.showError(e.data.message)})},e.add=function(t,o){n.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:null}}).then(function(t){r.showInfo("Client was created"),e.init()},function(){})},e.edit=function(t,o){n.show({controller:"ClientDialogController",templateUrl:"templates/client-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{client:o}}).then(function(t){r.showInfo("Client was updated"),e.init()},function(){})},e.delete=function(t,o){var l=n.confirm().title("You are about to delete the following").htmlContent("Client "+o.name).targetEvent(t).ok("Yes").cancel("No");n.show(l).then(function(){e.promise=i.destroy(o.id),e.promise.then(function(t){r.showInfo("Client was deleted"),e.init()},function(e){r.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("ClientDialogController",["$scope","$mdDialog","client","ClientService","MessageUtil",function(e,t,o,n,i){e.client={},e.promise=null,e.cancel=function(){t.cancel()},o?e.client=angular.copy(o):e.client.name="",console.log("Client",o),e.save=function(){e.client.id?e.promise=n.update(e.client.id,e.client):e.promise=n.store(e.client),e.promise.then(function(e){console.log("result",e),t.hide(e)},function(e){console.log("error",e),i.showError(e.data.message)})}}])}(meister),function(e){e.controller("HomeController",["$scope",function(e){e.treeOptions={showIcon:!1,expandOnClick:!0},e.basicTree=[{name:"Node 1",children:[{name:"Node 1.1",children:[{name:"Node 1.1.1"},{name:"Node 1.1.2"}]}]},{name:"Node 2",children:[{name:"Node 2.1"},{name:"Node 2.2"}]}],e.$on("selection-changed",function(t,o){console.log("Node selected",o),e.selectedNode=o}),e.$on("expanded-state-changed",function(t,o){console.log("Expanded node",o),e.expandedNode=o})}])}(meister),function(e){e.controller("LoginController",["$scope","$rootScope","$location","$mdToast","$cookies","AuthenticationService","MessageUtil",function(e,t,o,n,i,r,l){i.remove("meister-sdk-token"),e.login=function(){e.promise=r.Login(e.username,e.password),e.promise.then(function(e){console.log("Login",e),o.path("/")},function(e){console.log("failure login",e),l.showError("The user credentials were incorrect")})}}])}(meister),function(e){e.controller("MainController",["$scope","$rootScope","$cookies","$location","$timeout","$mdSidenav","$mdMenu","$state","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER","AuthenticationService",function(e,t,o,n,i,r,l,a,s,c,u,m){function f(e){return function(){r(e).toggle()}}console.log("MainController init"),t.toggleLeft=f("left"),t.toggleRight=f("right"),t.SYSTEM_ADMIN=s,t.CLIENT_ADMIN=c,t.CLIENT_USER=u,t.gotoHome=function(){t.transition="fade-in",a.go("home")},t.openMenu=function(e,t){e(t)},t.logout=function(){m.Logout().then(function(e){console.log("Logout successful",e),n.path("/login")},function(e){console.log(e)})},t.user_type=function(){var e=o.get("meister-sdk-token");return e?(e=angular.fromJson(e),e.user_type):-1},t.transition="fade-in"}])}(meister),function(e){e.controller("ReportsController",["$scope","$timeout","$mdSidenav","$state","$mdMedia","$mdMenu","$mdDialog","$stateParams","$mdToast","ReportService",function(e,t,o,n,i,r,l,a,s,c){e.isMobileDevice=i("xs"),e.reports=[],e.list_reports=[],e.report="",e.selected=[],e.init=function(){e.promise=c.getReports(),e.promise2=c.getListReports(),e.promise.then(function(t){var o=!0;angular.forEach(t.data.d.results,function(t,n){var i=angular.fromJson(t.Json);e.reports.push(i),o&&(e.report=i.REPORT_NAME,o=!1)})},function(e){console.log("failureReportService.getReports",e)}),e.promise2.then(function(t){console.log("ReportService.getListReports",t),e.list_reports=t.data},function(e){console.log("failureReportService.getListReports",e)})},e.schedule=function(t,o){console.log("schedule",o),l.show(l.alert().parent(angular.element(document.querySelector("#popupContainer"))).clickOutsideToClose(!0).title("Schedule Report successfull").textContent("Schedule Report success").ok("Ok").targetEvent(t)).then(function(){e.promise=c.schedule(o),e.promise.then(function(t){console.log("ReportService.schedule",t),e.init()},function(e){console.log("ReportService.schedule",e)})})},e.gotoReportSummary=function(e){"F"==e.STATUS?n.go("reports-summary",{PKY:e.PKY,reportName:e.REPORT_NAME}):s.show(s.simple().textContent("Report output is being prepared. Check back in a few minutes.").position("bottom").hideDelay(3e3))}}])}(meister),function(e){e.controller("ReportSummaryController",["$scope","$state","$mdMedia","$mdDialog","$stateParams","$timeout","ReportService",function(e,t,o,n,i,r,l){e.data=[],e.chartType="bar",e.isMobileDevice=o("xs"),e.chartData=[],e.labels=[],e.report_name="",e.filterDate="",e.chartOptions={onClick:function(t){var o=this.getElementAtEvent(t);if(o.length){var n=o[0]._index;r(function(){e.filterDate=e.labels[n]}),console.log(e.filterDate)}}},e.init=function(){console.log(i.PKY),e.report_name=i.reportName,e.promise=l.getDetails(i.PKY),e.promise.then(function(t){e.data=t.data,e.generateChart()},function(e){console.log("failure loading report details",e)})},e.gotoReports=function(){t.go("reports")},e.generateChart=function(){var t=l.buildDataForGraphicReports(e.data);e.chartData=t.data,e.labels=t.labels},e.removeFilters=function(){e.filterDate=""}}])}(meister),function(e){e.controller("UserController",["$scope","$location","$mdToast","$mdDialog","UserService","MessageUtil","SYSTEM_ADMIN","CLIENT_ADMIN","CLIENT_USER",function(e,t,o,n,i,r,l,a,s){e.users=[],e.promise=null,e.filter={show:!1},e.query={order:"email",limit:5,page:1,filterByEmail:"",filterByFirstName:"",filterByLastName:""},e.limitOptions=[5,10,25,50,100],e.removeFilter=function(){e.filter.show=!1,e.query.filterByEmail="",e.query.filterByFirstName="",e.query.filterByLastName=""},e.init=function(){console.log("UserController init..."),e.promise=i.index(),e.promise.then(function(t){console.log("result",t),e.users=t.data},function(e){console.log("failure login",e),r.showError(e.data.message)})},e.add=function(t,o){n.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:null}}).then(function(t){r.showInfo("User was created"),e.init()},function(){})},e.edit=function(t,o){n.show({controller:"UserDialogController",templateUrl:"templates/user-dialog-form.html",parent:angular.element(document.body),targetEvent:t,clickOutsideToClose:!1,escapeToClose:!1,locals:{user:o}}).then(function(t){r.showInfo("User was updated"),e.init()},function(){})},e.type=function(e){return e==l?"SYSTEM_ADMIN":e==a?"CLIENT_ADMIN":e==s?"CLIENT_USER":void 0},e.delete=function(t,o){var l=n.confirm().title("You are about to delete the following").htmlContent("User "+o.name).targetEvent(t).ok("Yes").cancel("No");n.show(l).then(function(){e.promise=i.destroy(o.id),e.promise.then(function(t){r.showInfo("User was deleted"),e.init()},function(e){r.showError(e.data.message)})},function(){})}}])}(meister),function(e){e.controller("UserDialogController",["$scope","$rootScope","$mdDialog","user","ClientService","UserService","MessageUtil",function(e,t,o,n,i,r,l){e.user={},e.types=[],e.clients=[],e.promise=null,e.cancel=function(){o.cancel()},n?e.user=angular.copy(n):(e.user.email="",e.user.first_name="",e.user.last_name="",e.user.type=t.CLIENT_USER,e.user.client_id=null),console.log("User",n),t.user_type()==t.SYSTEM_ADMIN?i.index().then(function(t){e.clients=t.data,e.user.id||(e.user.client_id=t.data[0].id)},function(e){console.log("error",e),l.showError(e.data.message)}):(e.clients=[],e.client_id=null),r.types().then(function(t){e.types=t.data},function(e){console.log("error",e),l.showError(e.data.message)}),e.save=function(){e.user.id?e.promise=r.update(e.user.id,e.user):e.promise=r.store(e.user),e.promise.then(function(e){console.log("result",e),o.hide(e)},function(e){console.log("error",e),l.showError(e.data.message)})}}])}(meister),function(e){e.directive("mainMenu",function(){return{restrict:"E",templateUrl:"templates/main-menu.html"}})}(meister),function(e){e.directive("mainToolbar",function(){return{restrict:"E",templateUrl:"templates/main-toolbar.html"}})}(meister);